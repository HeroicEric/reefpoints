<!DOCTYPE html><html><head><title>Introducing Capybara-Extensions</title><link href="/stylesheets/all-bd81847b.css" media="screen" rel="stylesheet" type="text/css" /><script src="/javascripts/all-d0af4672.js" type="text/javascript"></script><meta content='NO-CACHE' http-equiv='CACHE-CONTROL'><meta content='DockYard is a Ruby on Rails, PostgreSQL, and, Ember.js, web / mobile application development software consultancy based in Boston, MA.' namer='description'><meta content='ruby on rails, rails, ruby, ruby on rails training, ruby application development, ruby on rails application development, ember application development, ember.js application development, software application development, web, web application development, mobile, mobile application development, ios, ios application development, iphone, iphone application development, android, android application development, postgres, startups, enterprise, Boston, MA, Massachusetts, for hire' name='keywords'><meta content='web development, mobile development, startups, enterprise, ruby on rails, rails, ruby, ruby on rails training, Boston, for hire' name='keywords'><meta content='width=device-width, initial-scale=1, maximum-scale=1, user-scalable=0' name='viewport'><meta content='DockYard.com - Write more descriptive tests with additional finders and matchers for Capybara.' name='description'><meta content='michaeldupuisjr' name='twitter:creator'><meta content='summary' name='twitter:card'><meta content='@DockYard' name='twitter:site'><meta content='http://reefpoints.dockyard.com/2013/11/11/capybara-extensions.html' name='twitter:url'><meta content='Introducing Capybara-Extensions' name='twitter:title'><meta content='Write more descriptive tests with additional finders and matchers for Capybara.' name='twitter:description'><link href='http://dockyard.com/humans.txt' rel='author'><link href='/apple-touch-icon.png' rel='apple-touch-icon'><link href='/apple-touch-icon-precomposed.png' rel='apple-touch-icon-precomposed'><script>
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-24185112-2']);
    _gaq.push(['_trackPageview']);
  
    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
</script>
<!--
                                                                    ..
                                                                 ,Z+O.
                                                              .OO.O..
                                                             OZ..O.
                                                         ..OO..87.
                                                        .O7O..O...
                                                      .O...Z~O.
                                                   .:Z~. ..Z..
                                                  +O.O   .8..
                                     ...       .OO.  O  O?.
                             ..ZOOOOOOOOOZOOO.ZOZ.   .OO..
                           .OOOOOOOOOOOOOOOOOO..Z.   $O.
                         .ZOOOOOOOOOOOOOOOOOO.  .O..O.
                        .ZOOOOOOOOOOOOOOOOOOOZ  .:O$.
                        OZOOOOOOOOOOO...OOOOOOOZ$ZO
                      ..OOOOOOOOOOOOO  .OOOOOOOOOOO..
                      .OOOOOOOOOOOOOOOOOOOOOOOOOOOOO.
                      .OOOOOOOOOOOOOOOOOOOOOOOOOOOOZ.
                      OOOOOOOOOOOOOOOOOOOOOOOOOOOOOO.
                     .OOOOOOOOOOOOOOOOOOOOOOOOOOOOOO.
                     :OOOOOOOOOOOOOOOOOOOOOOOOOOOOOO.
                     ZOOOOOOOOOOOOOOOOOOOOOOOOOOOOOZ.
                     OOOOOOOOOOOOOOOOOOOOOOOOOOOO7OO.
                     ZOOOOOOOOOOOOOOOOOOOOOOOOOOOOOZ.
                     OOOOOOZOOOOOOOO.ZOOOOOOOOOOO7OO.
                     ZOOOOO.OOOOOOOO.OOOOOOOOOO.  OO.
...     ..           OOOOO.OOOOOOOO.OOOOOOOOO.   .O:
.OOZ...OOO.        ..OOOOO.OOOOOOO.OOOOOOOOZ.    .Z..
.OOOOOOOOO         .ZOOOOO.OOOOO..OOOOOOOO~      .Z
 .OOOOOOO.         .OOOOOO.OZZ..OOOOOOOOO.      .?O
  .OOOOOI.        .OOOOOOO..,ZOOOOOOOOOO..      .O.
   .OOOOZ.      ..ZOOOOOOOOOOOOOOOOOOOO~        .O.
   .OOOOO= .....ZOOOOOOOOOOOOOOOOOOOOOO.      ..O.
   ..OOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOZ       .,OO.
    .ZOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOO.     ...OO..
     .OOOOOOOOOOOOOOOOOOOOOOOOOOOOOOO.   ...OO.
     ..ZOOOOOOOOOOOOOOOOOOOOOOOOOOOO.... OZO..
      ...OOOOOOOOOOOOOOOOOOOOOOOOOOZOOOZO...
          .....~OOOOOOOOOOOOOOOOO:........
                ................
--></head><body id='blog'><header id='mobile-header'><div class='wrap'><a class='header-logo' href='/'>DockYard</a><div class='menu-button'></div></div><ul class='flexnav' data-breakpoint='481' id='mobile-nav'><li class='mobile-nav-link-wrap'><a class='mobile-nav-link' href='http://dockyard.com'><span class='mobile-nav-icon fontello'>h</span><p class='main-nav-item'>Home</p></a></li><li class='mobile-nav-link-wrap'><a class='mobile-nav-link' href='http://dockyard.com'><span class='mobile-nav-icon fontello'>w</span><p class='main-nav-item'>Work</p></a></li><li class='mobile-nav-link-wrap'><a class='mobile-nav-link' href='http://dockyard.com'><span class='mobile-nav-icon fontello'>p</span><p class='main-nav-item'>Team</p></a></li><li class='mobile-nav-link-wrap'><a class='mobile-nav-link' href='http://dockyard.com'><span class='mobile-nav-icon fontello'>c</span><p class='main-nav-item'>Community</p></a></li><li class='mobile-nav-link-wrap'><a class='mobile-nav-link' href='/'><span class='mobile-nav-icon fontello'>b</span><p class='main-nav-item'>Blog</p></a></li><li class='mobile-nav-link-wrap'><a class='mobile-nav-link' href='http://dockyard.com/hire-us'><span class='mobile-nav-icon fontello'>m</span><p class='main-nav-item'>Contact</p></a></li></ul></header><header id='site-header'><div class='wrap'><h1><a class='header-logo' href='http://dockyard.com'>DockYard</a></h1><ul class='main-nav'><li class='nav-work'><a class='main-nav-item' href='http://dockyard.com/work'>Work</a></li><li class='nav-work'><a class='main-nav-item' href='http://dockyard.com/team'>Team</a></li><li class='nav-work'><a class='main-nav-item' href='http://dockyard.com/community'>Community</a></li><li class='nav-work'><a class='main-nav-item current' href='/'>Blog</a></li><li class='nav-work'><a class='main-nav-item' href='http://dockyard.com/contact'>Contact</a></li></ul></div></header><section id='content'><section id='post'><aside class='post-metas-wrap'><ul class='post-metas'><li class='post-meta'><a class="post-author" href="/authors/michael-dupuis-jr.html">Michael Dupuis Jr.</a></li><li class='post-meta'><span><a class='link link-in-post fontello' href='http://twitter.com/michaeldupuisjr' target='_blank'>t</a><a class='link link-in-post fontello' href='https://github.com/michaeldupuisjr' target='_blank'>g</a></span></li><li class='post-meta post-date'>11 Nov 2013</li></ul></aside><div class='post-div'><p class='post-meta post-tags'><a class="tag-link" href="/categories/testing.html">Testing (1)</a>, <a class="tag-link" href="/categories/ruby.html">Ruby (1)</a><a class="tag-link" style="float: right" href="/categories.html">See all categories</a></p><div class='post-title-wrap'><h1 class='post-title'>Introducing Capybara-Extensions</h1></div><current_page class='post-content'><h2>Testing with Capybara</h2>

<p>We love Capybara at DockYard. We use it for virtually all of our integration tests and
rely on it for writing tests that not only replicate how users flow
through an application, but also for how they interact with page
elements.</p>

<p>Briefly, let&#39;s take a look at a Rails application with and without
Capybara. Without Capybara, inheriting from <code>ActionDispatch::IntegrationTest</code> provides
some helpful <code>RequestHelpers</code> like <code>get</code>, which takes a path, some
parameters, and headers (via <a href="http://guides.rubyonrails.org/testing.html#integration-testing-examples">RailsGuides</a>):</p>
<div class="highlight ruby "><div class="ribbon"></div><div class="scroller"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
2
3
4
5
6
7
8
9
<strong>10</strong>
11
12
13
14
15
16
17
18
19
<strong>20</strong>
21
</pre></td>
  <td class="code"><pre>require <span class="string"><span class="delimiter">'</span><span class="content">test_helper</span><span class="delimiter">'</span></span>

<span class="keyword">class</span> <span class="class">UserFlowsTest</span> &lt; <span class="constant">ActionDispatch</span>::<span class="constant">IntegrationTest</span>
  fixtures <span class="symbol">:users</span>

  test <span class="string"><span class="delimiter">&quot;</span><span class="content">login and browse site</span><span class="delimiter">&quot;</span></span> <span class="keyword">do</span>
    <span class="comment"># login via https</span>
    https!
    get <span class="string"><span class="delimiter">&quot;</span><span class="content">/login</span><span class="delimiter">&quot;</span></span>
    assert_response <span class="symbol">:success</span>

    post_via_redirect <span class="string"><span class="delimiter">&quot;</span><span class="content">/login</span><span class="delimiter">&quot;</span></span>, <span class="key">username</span>: users(<span class="symbol">:david</span>).username, <span class="key">password</span>: users(<span class="symbol">:david</span>).password
    assert_equal <span class="string"><span class="delimiter">'</span><span class="content">/welcome</span><span class="delimiter">'</span></span>, path
    assert_equal <span class="string"><span class="delimiter">'</span><span class="content">Welcome david!</span><span class="delimiter">'</span></span>, flash[<span class="symbol">:notice</span>]

    https!(<span class="predefined-constant">false</span>)
    get <span class="string"><span class="delimiter">&quot;</span><span class="content">/posts/all</span><span class="delimiter">&quot;</span></span>
    assert_response <span class="symbol">:success</span>
    assert assigns(<span class="symbol">:products</span>)
  <span class="keyword">end</span>
<span class="keyword">end</span>
</pre></td>
</tr></table>
</div></div>
<p>Capybara adds some syntactic sugar with its
<code>Capybara::Session#visit</code> method, and produces code that reads a lot cleaner and mimics
how a user engages with the application:</p>
<div class="highlight ruby "><div class="ribbon"></div><div class="scroller"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
2
3
4
5
6
7
8
9
<strong>10</strong>
11
12
13
14
15
16
17
18
19
<strong>20</strong>
21
22
23
</pre></td>
  <td class="code"><pre>require <span class="string"><span class="delimiter">'</span><span class="content">test_helper</span><span class="delimiter">'</span></span>
require <span class="string"><span class="delimiter">'</span><span class="content">capybara</span><span class="delimiter">'</span></span>
require <span class="string"><span class="delimiter">'</span><span class="content">capybara_minitest_spec</span><span class="delimiter">'</span></span> <span class="comment"># MiniTest::Spec expectations for Capybara</span>

<span class="keyword">class</span> <span class="class">PostsTest</span> &lt; <span class="constant">ActionDispatch</span>::<span class="constant">IntegrationTest</span>
  fixtures <span class="symbol">:users</span>

  test <span class="string"><span class="delimiter">&quot;</span><span class="content">login and browse site</span><span class="delimiter">&quot;</span></span> <span class="keyword">do</span>
    visit login_path

    within find(<span class="string"><span class="delimiter">'</span><span class="content">form#session-new</span><span class="delimiter">'</span></span>) <span class="keyword">do</span>
      fill_in <span class="string"><span class="delimiter">'</span><span class="content">username</span><span class="delimiter">'</span></span>, <span class="key">with</span>: users(<span class="symbol">:david</span>).username
      fill_in <span class="string"><span class="delimiter">'</span><span class="content">password</span><span class="delimiter">'</span></span>, <span class="key">with</span>: users(<span class="symbol">:david</span>).password
      click_button <span class="string"><span class="delimiter">'</span><span class="content">Submit</span><span class="delimiter">'</span></span>
    <span class="keyword">end</span> 

    current_path.must_equal welcome_path
    page.must_have_content <span class="string"><span class="delimiter">'</span><span class="content">Welcome david!</span><span class="delimiter">'</span></span>

    visit posts_path
    page.must_have_content <span class="string"><span class="delimiter">'</span><span class="content">Welcome to ReefPoints!</span><span class="delimiter">'</span></span>
  <span class="keyword">end</span>
<span class="keyword">end</span>
</pre></td>
</tr></table>
</div></div>
<p>Jonas Nicklas, who maintains Capybara, writes how the library leads to <a href="http://www.elabs.se/blog/51-simple-tricks-to-clean-up-your-capybara-tests">cleaner tests and clearer intent</a>. This is exactly what we
want from our tests, which not only test our code, but also
document our application&#39;s behavior. A lot more could be written about
this idea, but I&#39;m going to assume I&#39;m preaching to the choir here and
jump into DockYard&#39;s newest gem:
<a href="https://rubygems.org/gems/capybara-extensions">CapybaraExtensions</a>.</p>

<p>CapybaraExtensions extends Capybara&#39;s finders and matchers. Our goal is
to cull many of the <code>find</code> statements from our tests and remove the
verbose CSS and
xpath locators that come along with them. </p>

<h2>Finders</h2>

<h3>find_&lt;element&gt;</h3>

<p>The library contains helper
methods for finding elements like <code>form</code>, <code>table</code>, and lists, as well as
many HTML5 elements like <code>article</code>, <code>aside</code>, <code>footer</code>, and <code>header</code>. </p>

<p>So the above code in which we pass a CSS selector</p>
<div class="highlight ruby "><div class="ribbon"></div><div class="scroller"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
2
3
</pre></td>
  <td class="code"><pre>within find(<span class="string"><span class="delimiter">'</span><span class="content">form#session-new</span><span class="delimiter">'</span></span>) <span class="keyword">do</span>
  ...
<span class="keyword">end</span>
</pre></td>
</tr></table>
</div></div>
<p>becomes the following:</p>
<div class="highlight ruby "><div class="ribbon"></div><div class="scroller"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
2
3
</pre></td>
  <td class="code"><pre>within form(<span class="string"><span class="delimiter">'</span><span class="content">Login</span><span class="delimiter">'</span></span>) <span class="keyword">do</span>
  ...
<span class="keyword">end</span>
</pre></td>
</tr></table>
</div></div>
<p>In this example, &quot;Login&quot; is text found in the form. Passing the text contained within the element we&#39;re looking for better reflects what a user is thinking when she sees a form that
says &quot;Login.&quot;</p>

<p>Finder methods are also aliased so that you can call <code>#form</code>
instead of <code>#find_form</code> (which you might expect from a finder method).
This makes for better readability with the oft-used <code>Capybara::Session#within</code> method.</p>

<h3>first_&lt;element&gt;</h3>

<p>Each &quot;find&quot; method also has a corresponding &quot;first&quot; method. So when you
have multiple <code>article</code> elements on a page with the text &#39;Lorem ipsum,&#39; you can call
<code>first_article(&#39;Lorem ipsum&#39;)</code> without returning an ambiguous match in
Capybara.</p>

<h3>&lt;element&gt;_number</h3>

<p>In instances when you have lists or tables and you&#39;d like to verify the
content of a specific <code>li</code> or <code>tr</code>, CapybaraExtensions allows
you to target the nth occurence of the element via
<code>#list_item_number</code> and <code>#row_number</code>.</p>

<p>So given the following HTML:</p>
<div class="highlight html "><div class="ribbon"></div><div class="scroller"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
2
3
4
5
</pre></td>
  <td class="code"><pre><span class="tag">&lt;ul&gt;</span>
  <span class="tag">&lt;li&gt;</span>John Doe<span class="tag">&lt;/li&gt;</span>
  <span class="tag">&lt;li&gt;</span>Jane Doe<span class="tag">&lt;/li&gt;</span>
  <span class="tag">&lt;li&gt;</span>Juan Doe<span class="tag">&lt;/li&gt;</span>
<span class="tag">&lt;/ul&gt;</span>
</pre></td>
</tr></table>
</div></div>
<p>You can find the second <code>li</code> with:</p>
<div class="highlight ruby "><div class="ribbon"></div><div class="scroller"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
</pre></td>
  <td class="code"><pre>list_item_number(<span class="integer">2</span>) <span class="comment"># =&gt; 'Jane Doe'</span>
</pre></td>
</tr></table>
</div></div>
<p>Use these methods for testing how elements are being ordered.</p>

<h2>Matchers</h2>

<p>CapybaraExtensions extends Capybara&#39;s matchers with methods for
verifying the presence of images, the value of input fields, and the
presence of meta tags. All of these methods return a boolean.</p>

<h3>field_values</h3>

<p>CapybaraExtensions comes with a <code>#has_field_value?</code> method which checks
the value of a form field. Ensuring that your records save and update
correctly should be the domain of your unit tests, however this method
can come in handy when you&#39;re not persisting data to the back-end. For
example, after performing a search, you may want to ensure that the
query persists in the search field after redirect.</p>
<div class="highlight ruby "><div class="ribbon"></div><div class="scroller"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
2
3
4
</pre></td>
  <td class="code"><pre>within form(<span class="string"><span class="delimiter">'</span><span class="content">Search</span><span class="delimiter">'</span></span>) <span class="keyword">do</span>
  has_field_value?(<span class="string"><span class="delimiter">'</span><span class="content">search</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">capybara images</span><span class="delimiter">'</span></span>)
<span class="keyword">end</span>
<span class="comment"># =&gt; true</span>
</pre></td>
</tr></table>
</div></div>
<h3>images</h3>

<p>Asserting that text appears on the page is easy with Capybara&#39;s
<code>#must_have_content</code> method; asserting
that a particular image appears has always been a little tougher.
<code>#must_have_image</code> takes a hash with the <code>src</code> and/or <code>alt</code> attributes
you&#39;re looking for.</p>
<div class="highlight ruby "><div class="ribbon"></div><div class="scroller"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
2
3
</pre></td>
  <td class="code"><pre>page.has_image?(<span class="key">src</span>: <span class="string"><span class="delimiter">'</span><span class="content">http://gallery.photo.net/photo/8385754-md.jpg</span><span class="delimiter">'</span></span>,
<span class="key">alt</span>: <span class="string"><span class="delimiter">'</span><span class="content">Capybara</span><span class="delimiter">'</span></span>)
<span class="comment"># =&gt; true</span>
</pre></td>
</tr></table>
</div></div>
<h3>meta_tags</h3>

<p><code>#has_meta_tag</code> checks the <code>head</code> for meta tags. Just pass in the <code>name</code>
and <code>content</code> you&#39;re expecting to find. We use this method quite a bit to ensure that our pages are looking good
from a search engine optimization standpoint.</p>
<div class="highlight ruby "><div class="ribbon"></div><div class="scroller"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
2
</pre></td>
  <td class="code"><pre>page.has_meta_tag?(<span class="string"><span class="delimiter">'</span><span class="content">title</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">Introducing CapybaraExtensions</span><span class="delimiter">'</span></span>) 
<span class="comment"># =&gt; true</span>
</pre></td>
</tr></table>
</div></div>
<p>We hope this gem makes your tests a little more descriptive and your <code>test_helper.rb</code> a little lighter. As always, we welcome pull requests and issues via Github. Thanks!</p>

<h2>Resources</h2>

<ul>
<li>CapybaraExtensions on <a href="http://rubygems.org/gems/capybara-extensions">Rubygems</a></li>
<li>CapybaraExtensions on <a href="https://github.com/dockyard/capybara-extensions">Github</a></li>
<li>CapybaraExtensions on
<a href="http://rubydoc.info/gems/capybara-extensions/frames">RubyDoc.info</a></li>
</ul>
</current_page><p class='issue'>See a problem with the current page? &nbsp;<a href='https://github.com/dockyard/reefpoints/blob/master/source/posts/' target='_blank'>Send a pull request to contribute, we'll happily accept!</a></p><section class='post-share'><h1>Like the current page? Please share!</h1><div class='social-button'><a class='twitter-share-button' data-url='http://reefpoints.dockyard.com/2013/11/11/capybara-extensions.html' data-via='DockYard' href='https://twitter.com/share'>Tweet</a></div><script>
  !function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0];if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src='//platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document,'script','twitter-wjs');
</script><div class='social-button'><div class='g-plusone' data-href='#' data-size='medium' data-width='100'></div><script>
  (function() {var po = document.createElement('script'); po.type = 'text/javascript'; po.async = true;po.src = 'https://apis.google.com/js/plusone.js';var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(po, s);})();
</script></div></section><section id='post-comments'><div id='disqus_thread'></div><script>
  var disqus_shortname = 'reefpoints';
  (function() {
    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
    dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
</script><noscript>Please enable JavaScript to view the <a href='http://disqus.com/?ref_noscript'>comments powered by Disqus.</a></noscript></noscript></section></div></section><script>
  var path = window.location.pathname.split('/').reverse();
  var postname = path[0].split('.');
  var change = postname[0] + '.md';
  var newpath = 'https://github.com/dockyard/reefpoints/blob/master/source/posts/' + path[3] + '-' + path[2] + '-' + path[1] + '-' + change
  $('.issue a').attr('href', newpath);
</script>
</section><footer><ul class='footer-links'><li><a class='link link-in-footer fontello' href='https://github.com/DockYard' target='_blank'>g</a></li><li><a class='link link-in-footer fontello' href='https://twitter.com/DockYard' target='_blank'>t</a></li><li><a class='link link-in-footer fontello' href='http://reefpoints.dockyard.com/atom.xml' target='_blank'>r</a></li><li><a class='link link-in-footer fontello' href='http://dockyard.com/hire-us' target='_blank'>m</a></li></ul><form class='footer-form'><label class='footer-form-label'>Get in touch with us!</label><input class='footer-form-input' placeholder='Email' type='text'><button class='footer-form-submit fontello' href='http://dockyard.com/contact'>R</button></form><a class='footer-number' href='tel:855-362-5973'>(855) DOCK-YRD</a><p class='footer-copyright'>&copy; 2013 DockYard, LLC. All Rights Reserved.</p></footer><audio class='foghorn' preload='auto' src='/sound/foghorn.mp3'></audio><script>
  /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
  var disqus_shortname = 'reefpoints'; // required: replace example with your forum shortname
  
  /* * * DON'T EDIT BELOW THIS LINE * * */
  (function () {
      var s = document.createElement('script'); s.async = true;
      s.type = 'text/javascript';
      s.src = 'http://' + disqus_shortname + '.disqus.com/count.js';
      (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
  }());
</script></body></html>
