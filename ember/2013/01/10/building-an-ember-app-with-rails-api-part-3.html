<!DOCTYPE html><html><head><title>Building an Ember app with RailsAPI - Part 3</title><link href="/stylesheets/all-509d6afb.css" media="screen" rel="stylesheet" type="text/css" /><script src="/javascripts/all-c96a81f7.js" type="text/javascript"></script><meta content='NO-CACHE' http-equiv='CACHE-CONTROL'><meta content='DockYard is a Ruby on Rails, PostgreSQL, and, Ember.js, web / mobile application development software consultancy based in Boston, MA.' namer='description'><meta content='ruby on rails, rails, ruby, ruby on rails training, ruby application development, ruby on rails application development, ember application development, ember.js application development, software application development, web, web application development, mobile, mobile application development, ios, ios application development, iphone, iphone application development, android, android application development, postgres, startups, enterprise, Boston, MA, Massachusetts, for hire' name='keywords'><meta content='web development, mobile development, startups, enterprise, ruby on rails, rails, ruby, ruby on rails training, Boston, for hire' name='keywords'><meta content='width=device-width, initial-scale=1, maximum-scale=1, user-scalable=0' name='viewport'><meta charset='utf-8'><meta content="DockYard.com - CUD, it isn't just for cows" name='description'><meta content='bcardarella' name='twitter:creator'><meta content='summary' name='twitter:card'><meta content='@DockYard' name='twitter:site'><meta content='http://reefpoints.dockyard.com/ember/2013/01/10/building-an-ember-app-with-rails-api-part-3.html' name='twitter:url'><meta content='Building an Ember app with RailsAPI - Part 3' name='twitter:title'><meta content="CUD, it isn't just for cows" name='twitter:description'><link href='//cloud.typography.com/6496052/702882/css/fonts.css' rel='stylesheet' type='text/css'><link href='http://dockyard.com/humans.txt' rel='author'><link href='/favicon-573a5e34.png' rel='shortcut icon' type='image/x-icon'><link href='/favicon-573a5e34.png' rel='icon' type='image/x-icon'><link href='/apple-touch-icon.png' rel='apple-touch-icon'><link href='/apple-touch-icon-precomposed.png' rel='apple-touch-icon-precomposed'><script>
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-24185112-2']);
    _gaq.push(['_trackPageview']);
  
    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
</script>
<!--
                                             ..
                                           .O.
                                       .:OO.
                                      :OOO.
                                    :OOO:.
                         ...      :OOOO:
                   ..ZOOOOOOOOO..OZ.O.
                   OOOOOOOOOOOOOOOOI
                  OOOOOOOOOOOOOOOOI,
                 OOOOOOOO. .OOOOOOOO:
                 OOOOOOOO   OOOOOOOOO:
                OOOOOOOOOOOOOOOOOOOOO.
                OOOOOOOOOOOOOOOOOOOOO:
               .OOOOOOOOOOOOOOOOOOOOO:
               .OOOOOOOOOOOOOOOOOOOOO.
                OOOOOOOOOOOOOOOOOOOOO
                OOOOOO?:   .OOOOOOOOO
               .OOOOO      OOOOOOOOOO
,OO ZO~        OOOOO,     OOOOOOOOOO+
 OOOOO.        OOOOO     OOOOOOOOOOO+
  OOO?        OOOOO     .OOOOOOOOOOO:
   OOO,      OOOOO.    .OOOOOOOOOOOO
    OOOOOOOOOOOOO.    .OOOOOOOOOOOO.
     OOOOOOOOOOOO.  .OOOOOOOOOOOOO.
      8OOOOOOOOOOOOOOOOOOOOOOOODO:
         :OOOOOOOOOOOOOOOOOOOO::

--></head><body class='ember ember_2013 ember_2013_01 ember_2013_01_10 ember_2013_01_10_building-an-ember-app-with-rails-api-part-3'><header><div class='extended-header-wrap has-border--bottom'><div class='l-wrap--wide'><nav class='extended-nav has-border--bottom'><a class='extended-nav--logo' data-icon='⌂' href='http://dockyard.com/'><span class='is-hidden'>Home</span></a><a class='extended-nav--close' data-icon='X'><span class='is-hidden'>Close</span></a><div class='extended-nav__items-wrap'><div class='extended-nav__items'><a class='extended-nav__item' href='http://dockyard.com/team'>Our Team</a><a class='extended-nav__item' href='http://dockyard.com/community'>Community</a><a class='extended-nav__item active' href='/'>Blog</a><a class='extended-nav__item' href='http://dockyard.com/hire-us'>Hire Us</a></div></div></nav><nav class='work-nav'><p>Selected Work</p><a class='work-nav-item' href='http://dockyard.com/work/credit-card-reviews'><h4 class='work-nav-item__title'>Credit Card Reviews</h4><p class='work-nav-item__desc'>Credit card advice from real people.</p></a><a class='work-nav-item' href='http://dockyard.com/work/coachup'><h4 class='work-nav-item__title'>CoachUp</h4><p class='work-nav-item__desc'>You should be training. Right now.</p></a><a class='work-nav-item' href='http://dockyard.com/work/askthem'><h4 class='work-nav-item__title'>AskThem</h4><p class='work-nav-item__desc'>Ask officials questions on city, state, and federal levels.</p></a><a class='work-nav-item' href='http://dockyard.com/work/beacon-hill-blitz'><h4 class='work-nav-item__title'>Beacon Hill Blitz</h4><p class='work-nav-item__desc'>How technology helped repeal the #TechTax.</p></a></nav></div></div><nav class='main-nav-wrap has-border--bottom'><div class='main-nav l-wrap--wide'><a class='logo' href='http://dockyard.com'>DockYard</a><a class='club-sandwich' data-icon='☰'><span class='is-hidden'>Navigation</span></a></div></nav></header><div class='push--header'></div><div class='l-wrap'><a class='logo--reefpoints' href='/'>ReefPoints</a><div class='search-wrap'><form class='search' data-url='/'><input class='search__input' id='search' name='search' placeholder='Search all posts' type='text' value=''><button class='search__submit' href='/'></button></form></div><nav class='blog-topnav'><a class="blog-topnav__item " href="/">Posts</a><a class="blog-topnav__item " href="/tags.html">Tags</a><a class="blog-topnav__item " href="/authors.html">Authors</a></nav><div class='post-wrap--no-comments'><aside class='post__metas--post l-post__metas'><a class='icon' data-icon='#' href='http://twitter.com/bcardarella' target='_blank'><span class='is-hidden'>Twitter</span></a><a class='icon' data-icon='★' href='https://github.com/bcardarella' target='_blank'><span class='is-hidden'>GitHub</span></a><a class="post__meta--author" href="/authors/brian-cardarella.html">Brian Cardarella</a><p class='post__meta--date'>10 Jan 2013</p><p class='post__meta--tags'><a class="post__meta--tag" href="/tags/ember.html">Ember.js (10)</a> <a class="post__meta--tag" href="/tags/javascript.html">JavaScript (8)</a> <a class="post__meta--tag" href="/tags/ruby-on-rails.html">Ruby on Rails (25)</a></p></aside><div class='post l-post'><h1 class='post__title'>Building an Ember app with RailsAPI - Part 3</h1><current_page class='post__content'><p><strong>This article was last updated on May 28, 2013 and reflects the state
 of Ember (1.0.0-rc4) and the latest build of Ember Data (0.13) as of
that date.</strong></p>

<p><a href="https://github.com/bcardarella/ember-railsapi">Fork the project on Github!</a></p>

<p><a href="http://ember-rails-api.herokuapp.com/">Use the app live on Heroku</a></p>

<p>In <a href="/ember/2013/01/07/building-an-ember-app-with-rails-api-part-1.html">Part 1</a> I showed you how to setup a <code>Rails-API</code> app for Ember.</p>

<p>In <a href="/ember/2013/01/09/building-an-ember-app-with-rails-api-part-2.html">Part 2</a> I showed you the basics of building an Ember app, reading from a backend API and displaying that information.</p>

<p>Today we&#39;re going to do some coding on the Rails side and the Ember side to add Creating, Updating, and Destroying records.</p>

<h2>Part 3 - The Big Finish</h2>

<p>In <a href="http://reefpoints.dockyard.com/ember/2013/01/07/building-an-ember-app-with-rails-api-part-1.html">Part 1</a> we setup the backend using <a href="https://github.com/rails-api/rails-api/">Rails API</a>. In <a href="http://reefpoints.dockyard.com/ember/2013/01/09/building-an-ember-app-with-rails-api-part-2.html">Part 2</a> we built out the basics of an Ember app, reading from a remote data source and displaying that data. Now we&#39;re going to add the ability to Create, Update, and Destroy that data. This part will be a mix of Ember and Rails code.</p>

<p><em>Note: If you have been following along that <a href="http://reefpoints.dockyard.com/ember/2013/01/09/building-an-ember-app-with-rails-api-part-2.html">Part 2</a> was recently updated to reflect new changes to the Ember Router, you will need to go back and update your code. Absolute make sure to update your ember.js and ember-data.js dependencies as they have been updated on the github repo</em></p>

<h3>Create</h3>

<p>Let&#39;s start by adding a <code>Create</code> button to our index page:</p>
<div class="highlight handlebars "><div class="ribbon"></div><div class="scroller"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
</pre></td>
  <td class="code"><pre><span class="inline"><span class="inline-delimiter">{{#</span><span class="attribute-name">linkTo</span> <span class="error">'</span><span class="attribute-name">users.new</span><span class="error">'</span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">'</span><span class="content">btn btn-primary</span><span class="delimiter">'</span></span><span class="inline-delimiter">}}</span></span>Create<span class="inline"><span class="inline-delimiter">{{/</span><span class="attribute-name">linkTo</span><span class="inline-delimiter">}}</span></span>
</pre></td>
</tr></table>
</div></div>
<p>We need to add the proper route so the index page doesn&#39;t blow up. While we&#39;re in here we&#39;ll add the <code>edit</code> route as well.</p>
<div class="highlight coffeescript "><div class="ribbon"></div><div class="scroller"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
2
3
4
5
6
7
</pre></td>
  <td class="code"><pre>App.Router.map -&gt;
  @resource 'users', -&gt;
    @route 'new'
    @route 'edit',
      path: '/:user_id/edit'
    @route 'show',
      path: '/:user_id'
</pre></td>
</tr></table>
</div></div>
<p>And now we can add the <code>UsersNewRoute</code></p>
<div class="highlight coffeescript "><div class="ribbon"></div><div class="scroller"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
2
3
4
5
</pre></td>
  <td class="code"><pre>App.UsersNewRoute = App.UsersRoute.extend
  model: -&gt;
    App.User.createRecord()
  setupController: (controller, model) -&gt;
    controller.set('content', model)
</pre></td>
</tr></table>
</div></div>
<p>Don&#39;t be fooled by the <code>createRecord()</code> call. This will not write anything to the backend. This call is simply used to create a new model. Now let&#39;s create the template <code>app/assets/javascripts/templates/users/new.hbs</code></p>
<div class="highlight handlebars "><div class="ribbon"></div><div class="scroller"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
2
3
4
5
6
7
8
9
<strong>10</strong>
11
12
13
14
15
16
17
18
19
<strong>20</strong>
21
</pre></td>
  <td class="code"><pre><span class="tag">&lt;h1&gt;</span>Create <span class="inline"><span class="inline-delimiter">{{</span><span class="attribute-name">fullName</span><span class="inline-delimiter">}}</span></span><span class="tag">&lt;/h1&gt;</span>
<span class="tag">&lt;form&gt;</span>
  <span class="tag">&lt;fieldset&gt;</span>
    <span class="tag">&lt;div&gt;</span>
      <span class="tag">&lt;label</span> <span class="inline"><span class="inline-delimiter">{{</span><span class="attribute-name">bindAttr</span> <span class="attribute-name">for</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">firstNameField.elementId</span><span class="delimiter">&quot;</span></span><span class="inline-delimiter">}}</span></span><span class="tag">&gt;</span>First Name<span class="tag">&lt;/label&gt;</span>
      <span class="inline"><span class="inline-delimiter">{{</span><span class="attribute-name">view</span> <span class="attribute-name">Ember.TextField</span> <span class="attribute-name">valueBinding</span>=<span class="string"><span class="delimiter">'</span><span class="content">firstName</span><span class="delimiter">'</span></span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">'</span><span class="content">first_name</span><span class="delimiter">'</span></span> <span class="attribute-name">viewName</span>=<span class="string"><span class="delimiter">'</span><span class="content">firstNameField</span><span class="delimiter">'</span></span><span class="inline-delimiter">}}</span></span>
    <span class="tag">&lt;/div&gt;</span>
    <span class="tag">&lt;div&gt;</span>
      <span class="tag">&lt;label</span> <span class="inline"><span class="inline-delimiter">{{</span><span class="attribute-name">bindAttr</span> <span class="attribute-name">for</span>=<span class="string"><span class="delimiter">'</span><span class="content">lastNameField.elementId</span><span class="delimiter">'</span></span><span class="inline-delimiter">}}</span></span><span class="tag">&gt;</span>Last Name<span class="tag">&lt;/label&gt;</span>
      <span class="inline"><span class="inline-delimiter">{{</span><span class="attribute-name">view</span> <span class="attribute-name">Ember.TextField</span> <span class="attribute-name">valueBinding</span>=<span class="string"><span class="delimiter">'</span><span class="content">lastName</span><span class="delimiter">'</span></span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">'</span><span class="content">last_name</span><span class="delimiter">'</span></span> <span class="attribute-name">viewName</span>=<span class="string"><span class="delimiter">'</span><span class="content">lastNameField</span><span class="delimiter">'</span></span><span class="inline-delimiter">}}</span></span>
    <span class="tag">&lt;/div&gt;</span>
    <span class="tag">&lt;div&gt;</span>
      <span class="tag">&lt;label</span> <span class="inline"><span class="inline-delimiter">{{</span><span class="attribute-name">bindAttr</span> <span class="attribute-name">for</span>=<span class="string"><span class="delimiter">'</span><span class="content">quoteField.elementId</span><span class="delimiter">'</span></span><span class="inline-delimiter">}}</span></span><span class="tag">&gt;</span>Quote<span class="tag">&lt;/label&gt;</span>
      <span class="inline"><span class="inline-delimiter">{{</span><span class="attribute-name">view</span> <span class="attribute-name">Ember.TextArea</span> <span class="attribute-name">valueBinding</span>=<span class="string"><span class="delimiter">'</span><span class="content">quote</span><span class="delimiter">'</span></span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">'</span><span class="content">quote</span><span class="delimiter">'</span></span> <span class="attribute-name">viewName</span>=<span class="string"><span class="delimiter">'</span><span class="content">quoteField</span><span class="delimiter">'</span></span><span class="inline-delimiter">}}</span></span>
    <span class="tag">&lt;/div&gt;</span>
    <span class="tag">&lt;a</span> <span class="attribute-name">href</span>=<span class="string"><span class="delimiter">'</span><span class="content">#</span><span class="delimiter">'</span></span> <span class="inline"><span class="inline-delimiter">{{</span><span class="attribute-name">action</span> <span class="attribute-name">save</span><span class="inline-delimiter">}}</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">'</span><span class="content">btn btn-success</span><span class="delimiter">'</span></span><span class="tag">&gt;</span>Create<span class="tag">&lt;/a&gt;</span>
  <span class="tag">&lt;/fieldset&gt;</span>
<span class="tag">&lt;/form&gt;</span>
<span class="tag">&lt;div</span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">'</span><span class="content">page-header</span><span class="delimiter">'</span></span><span class="tag">&gt;</span><span class="tag">&lt;/div&gt;</span>

<span class="tag">&lt;a</span> <span class="attribute-name">href</span>=<span class="string"><span class="delimiter">'</span><span class="content">#</span><span class="delimiter">'</span></span> <span class="inline"><span class="inline-delimiter">{{</span><span class="attribute-name">action</span> <span class="attribute-name">cancel</span><span class="inline-delimiter">}}</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">'</span><span class="content">btn btn-inverse</span><span class="delimiter">'</span></span><span class="tag">&gt;</span>Cancel<span class="tag">&lt;/a&gt;</span>
</pre></td>
</tr></table>
</div></div>
<p>Next we&#39;ll add <code>app/assets/javascripts/controllers/users/newController.coffeescript</code></p>
<div class="highlight coffeescript "><div class="ribbon"></div><div class="scroller"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
2
3
4
5
6
7
8
9
<strong>10</strong>
11
</pre></td>
  <td class="code"><pre>App.UsersNewController = Ember.ObjectController.extend
  headerTitle: 'Create'
  buttonTitle: 'Create'

  save: -&gt;
    @content.save().then =&gt;
      @transitionToRoute('users.show', @content)

  cancel: -&gt;
    @content.deleteRecord()
    @transitionToRoute('users.index')
</pre></td>
</tr></table>
</div></div>
<p>The first two functions <code>save</code> and <code>cancel</code> are actions that are mapped in the template. Let&#39;s break down each:</p>

<ul>
<li><code>save</code> will make a call to <code>this.store.commit()</code>. You will notice we are not modifying a model, assigning params, etc... as you would in a Rails app. Keep in mind that when you modify data that is bound in the form you are actually modifying the data in the model itself. The datastore in Ember needs to be directed when these modifications should be made &quot;permanent&quot;, and because we are using the RESTAdapter Ember will attempt to write these changes to the backend.</li>
<li><code>cancel</code> If the user decides to not create a new user we must delete the record we created then transition to the <code>index</code> page.</li>
</ul>

<p><a href="http://emberjs.com/guides/models/model-lifecycle">Learn more about the Ember Model Lifecycle</a></p>

<p>Finally we&#39;re going to hook up the back end in <code>app/controllers/users_controller.rb</code></p>
<div class="highlight ruby "><div class="ribbon"></div><div class="scroller"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
2
3
4
5
6
7
8
9
</pre></td>
  <td class="code"><pre><span class="keyword">def</span> <span class="function">create</span>
  user = <span class="constant">User</span>.new(params[<span class="symbol">:user</span>])

  <span class="keyword">if</span> user.save
    render <span class="key">json</span>: user
  <span class="keyword">else</span>
    render <span class="key">json</span>: user, <span class="key">status</span>: <span class="integer">422</span>
  <span class="keyword">end</span>
<span class="keyword">end</span>
</pre></td>
</tr></table>
</div></div>
<p>It has been mentioned that <code>422</code> is the proper status code for validation failures. Personally I would prefer to use <code>respond_with</code> but it isn&#39;t part of the default Rails-API stack, <a href="https://groups.google.com/forum/?fromgroups=#!topic/rails-api-core/QhPh2VG7yTU">hopefully this will change</a>.</p>

<p>Now let&#39;s run our app and see how it goes.</p>

<p><img src="http://i.imgur.com/kFC9arb.png" alt="New1"></p>

<p>Whoops, we have <code>undefined undefined</code> for the <code>fullName</code>. Let&#39;s set default values of an empty string in our user model:</p>
<div class="highlight coffeescript "><div class="ribbon"></div><div class="scroller"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
2
3
4
5
6
7
</pre></td>
  <td class="code"><pre>App.User = DS.Model.extend
  firstName: DS.attr('string', defaultValue: '' )
  lastName: DS.attr('string', defaultValue: '' )
  quote: DS.attr('string')
  fullName: (-&gt;
    &quot;#{@get('firstName')} #{@get('lastName')}&quot;
  ).property('firstName', 'lastName')
</pre></td>
</tr></table>
</div></div>
<p>Now when we add data and create it will write to the back end, take us to the show page. When can then click <code>Back</code> and we can see the record has been automatically added to the collection on the <code>index</code> page.</p>

<p>Adding <code>Edit</code> should be straight forward now that we have done create. Start will adding the route:</p>
<div class="highlight coffeescript "><div class="ribbon"></div><div class="scroller"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
2
3
4
5
6
</pre></td>
  <td class="code"><pre>App.UsersEditRoute = Ember.Route.extend
  model: (params) -&gt;
    App.User.find(params.user_id)
  setupController: (controller, model) -&gt;
    controller.set('content', model)
    @controllerFor('application').set('currentRoute', 'users')
</pre></td>
</tr></table>
</div></div>
<p>You&#39;ll notice that this route is identical to <code>App.UsersShowRoute</code> we wrote in Part 2, let&#39;s DRY this up</p>
<div class="highlight coffeescript "><div class="ribbon"></div><div class="scroller"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
2
3
4
5
6
7
8
9
</pre></td>
  <td class="code"><pre>App.UserRoute = Ember.Route.extend
  model: (params) -&gt;
    App.User.find(params.user_id)
  setupController: (controller, model) -&gt;
    controller.set('content', model)
    @controllerFor('application').set('currentRoute', 'users')

App.UsersShowRoute = App.UserRoute.extend()
App.UsersEditRoute = App.UserRoute.extend()
</pre></td>
</tr></table>
</div></div>
<p>Next we&#39;ll add the edit link to <code>app/assets/javascripts/templates/users/show.hbs</code></p>
<div class="highlight handlebars "><div class="ribbon"></div><div class="scroller"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
</pre></td>
  <td class="code"><pre><span class="inline"><span class="inline-delimiter">{{#</span><span class="attribute-name">linkTo</span> <span class="error">'</span><span class="attribute-name">users.edit</span><span class="error">'</span> <span class="attribute-name">content</span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">'</span><span class="content">btn btn-primary</span><span class="delimiter">'</span></span><span class="inline-delimiter">}}</span></span>Edit<span class="inline"><span class="inline-delimiter">{{/</span><span class="attribute-name">linkTo</span><span class="inline-delimiter">}}</span></span>
</pre></td>
</tr></table>
</div></div>
<p>Now the edit template itself in <code>app/assets/javascripts/templates/users/edit.hbs</code></p>
<div class="highlight handlebars "><div class="ribbon"></div><div class="scroller"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
2
3
4
5
6
7
8
9
<strong>10</strong>
11
12
13
14
15
16
17
18
19
<strong>20</strong>
21
</pre></td>
  <td class="code"><pre><span class="tag">&lt;h1&gt;</span>Edit <span class="inline"><span class="inline-delimiter">{{</span><span class="attribute-name">fullName</span><span class="inline-delimiter">}}</span></span><span class="tag">&lt;/h1&gt;</span>
<span class="tag">&lt;form&gt;</span>
  <span class="tag">&lt;fieldset&gt;</span>
    <span class="tag">&lt;div&gt;</span>
      <span class="tag">&lt;label</span> <span class="inline"><span class="inline-delimiter">{{</span><span class="attribute-name">bindAttr</span> <span class="attribute-name">for</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">firstNameField.elementId</span><span class="delimiter">&quot;</span></span><span class="inline-delimiter">}}</span></span><span class="tag">&gt;</span>First Name<span class="tag">&lt;/label&gt;</span>
      <span class="inline"><span class="inline-delimiter">{{</span><span class="attribute-name">view</span> <span class="attribute-name">Ember.TextField</span> <span class="attribute-name">valueBinding</span>=<span class="string"><span class="delimiter">'</span><span class="content">firstName</span><span class="delimiter">'</span></span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">'</span><span class="content">first_name</span><span class="delimiter">'</span></span> <span class="attribute-name">viewName</span>=<span class="string"><span class="delimiter">'</span><span class="content">firstNameField</span><span class="delimiter">'</span></span><span class="inline-delimiter">}}</span></span>
    <span class="tag">&lt;/div&gt;</span>
    <span class="tag">&lt;div&gt;</span>
      <span class="tag">&lt;label</span> <span class="inline"><span class="inline-delimiter">{{</span><span class="attribute-name">bindAttr</span> <span class="attribute-name">for</span>=<span class="string"><span class="delimiter">'</span><span class="content">lastNameField.elementId</span><span class="delimiter">'</span></span><span class="inline-delimiter">}}</span></span><span class="tag">&gt;</span>Last Name<span class="tag">&lt;/label&gt;</span>
      <span class="inline"><span class="inline-delimiter">{{</span><span class="attribute-name">view</span> <span class="attribute-name">Ember.TextField</span> <span class="attribute-name">valueBinding</span>=<span class="string"><span class="delimiter">'</span><span class="content">lastName</span><span class="delimiter">'</span></span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">'</span><span class="content">last_name</span><span class="delimiter">'</span></span> <span class="attribute-name">viewName</span>=<span class="string"><span class="delimiter">'</span><span class="content">lastNameField</span><span class="delimiter">'</span></span><span class="inline-delimiter">}}</span></span>
    <span class="tag">&lt;/div&gt;</span>
    <span class="tag">&lt;div&gt;</span>
      <span class="tag">&lt;label</span> <span class="inline"><span class="inline-delimiter">{{</span><span class="attribute-name">bindAttr</span> <span class="attribute-name">for</span>=<span class="string"><span class="delimiter">'</span><span class="content">quoteField.elementId</span><span class="delimiter">'</span></span><span class="inline-delimiter">}}</span></span><span class="tag">&gt;</span>Quote<span class="tag">&lt;/label&gt;</span>
      <span class="inline"><span class="inline-delimiter">{{</span><span class="attribute-name">view</span> <span class="attribute-name">Ember.TextArea</span> <span class="attribute-name">valueBinding</span>=<span class="string"><span class="delimiter">'</span><span class="content">quote</span><span class="delimiter">'</span></span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">'</span><span class="content">quote</span><span class="delimiter">'</span></span> <span class="attribute-name">viewName</span>=<span class="string"><span class="delimiter">'</span><span class="content">quoteField</span><span class="delimiter">'</span></span><span class="inline-delimiter">}}</span></span>
    <span class="tag">&lt;/div&gt;</span>
    <span class="tag">&lt;a</span> <span class="attribute-name">href</span>=<span class="string"><span class="delimiter">'</span><span class="content">#</span><span class="delimiter">'</span></span> <span class="inline"><span class="inline-delimiter">{{</span><span class="attribute-name">action</span> <span class="attribute-name">save</span><span class="inline-delimiter">}}</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">'</span><span class="content">btn btn-success</span><span class="delimiter">'</span></span><span class="tag">&gt;</span>Update<span class="tag">&lt;/a&gt;</span>
  <span class="tag">&lt;/fieldset&gt;</span>
<span class="tag">&lt;/form&gt;</span>
<span class="tag">&lt;div</span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">'</span><span class="content">page-header</span><span class="delimiter">'</span></span><span class="tag">&gt;</span><span class="tag">&lt;/div&gt;</span>

<span class="tag">&lt;a</span> <span class="attribute-name">href</span>=<span class="string"><span class="delimiter">'</span><span class="content">#</span><span class="delimiter">'</span></span> <span class="inline"><span class="inline-delimiter">{{</span><span class="attribute-name">action</span> <span class="attribute-name">cancel</span> <span class="attribute-name">target</span>=<span class="string"><span class="delimiter">'</span><span class="content">controller</span><span class="delimiter">'</span></span><span class="inline-delimiter">}}</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">'</span><span class="content">btn btn-inverse</span><span class="delimiter">'</span></span><span class="tag">&gt;</span>Cancel<span class="tag">&lt;/a&gt;</span>
</pre></td>
</tr></table>
</div></div>
<p>And now the controller <code>app/assets/javascripts/controllers/users/editController.coffee</code></p>
<div class="highlight coffeescript "><div class="ribbon"></div><div class="scroller"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
2
3
4
5
6
7
8
9
<strong>10</strong>
11
12
13
14
15
16
17
</pre></td>
  <td class="code"><pre>App.UsersEditController = Ember.ObjectController.extend
  destroy: -&gt;
    @content.deleteRecord()
    @store.commit()
    @transitionTo('users.index')

  save: -&gt;
    @content.save().then =&gt;
      @transitionToRoute('users.show', @content)

  cancel: -&gt;
    if @content.isDirty
      @content.rollback()
    @transitionTo('users.show', @content)

  buttonTitle: 'Edit'
  headerTitle: 'Editing'
</pre></td>
</tr></table>
</div></div>
<p>This controller looks similar to <code>App.UsersNewController</code> but let&#39;s explore the differences</p>

<ul>
<li><code>save</code> here because the model already has an <code>id</code> we can commit to the datastore and transition.</li>
<li><code>cancel</code> instead of deleting the record we want to rollback to its previous state. And we can only rollback if the record has changed.</li>
</ul>

<p>I&#39;m sure you know what is next. The <code>new</code> template is nearly identical to the <code>edit</code> template. Let&#39;s create <code>app/assets/javascripts/templates/users/form.hbs</code></p>
<div class="highlight handlebars "><div class="ribbon"></div><div class="scroller"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
2
3
4
5
6
7
8
9
<strong>10</strong>
11
12
13
14
15
16
17
18
19
<strong>20</strong>
21
</pre></td>
  <td class="code"><pre><span class="tag">&lt;h1&gt;</span><span class="inline"><span class="inline-delimiter">{{</span><span class="attribute-name">headerTitle</span><span class="inline-delimiter">}}</span></span> <span class="inline"><span class="inline-delimiter">{{</span><span class="attribute-name">fullName</span><span class="inline-delimiter">}}</span></span><span class="tag">&lt;/h1&gt;</span>
<span class="tag">&lt;form&gt;</span>
  <span class="tag">&lt;fieldset&gt;</span>
    <span class="tag">&lt;div&gt;</span>
      <span class="tag">&lt;label</span> <span class="inline"><span class="inline-delimiter">{{</span><span class="attribute-name">bindAttr</span> <span class="attribute-name">for</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">firstNameField.elementId</span><span class="delimiter">&quot;</span></span><span class="inline-delimiter">}}</span></span><span class="tag">&gt;</span>First Name<span class="tag">&lt;/label&gt;</span>
      <span class="inline"><span class="inline-delimiter">{{</span><span class="attribute-name">view</span> <span class="attribute-name">Ember.TextField</span> <span class="attribute-name">valueBinding</span>=<span class="string"><span class="delimiter">'</span><span class="content">firstName</span><span class="delimiter">'</span></span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">'</span><span class="content">first_name</span><span class="delimiter">'</span></span> <span class="attribute-name">viewName</span>=<span class="string"><span class="delimiter">'</span><span class="content">firstNameField</span><span class="delimiter">'</span></span><span class="inline-delimiter">}}</span></span>
    <span class="tag">&lt;/div&gt;</span>
    <span class="tag">&lt;div&gt;</span>
      <span class="tag">&lt;label</span> <span class="inline"><span class="inline-delimiter">{{</span><span class="attribute-name">bindAttr</span> <span class="attribute-name">for</span>=<span class="string"><span class="delimiter">'</span><span class="content">lastNameField.elementId</span><span class="delimiter">'</span></span><span class="inline-delimiter">}}</span></span><span class="tag">&gt;</span>Last Name<span class="tag">&lt;/label&gt;</span>
      <span class="inline"><span class="inline-delimiter">{{</span><span class="attribute-name">view</span> <span class="attribute-name">Ember.TextField</span> <span class="attribute-name">valueBinding</span>=<span class="string"><span class="delimiter">'</span><span class="content">lastName</span><span class="delimiter">'</span></span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">'</span><span class="content">last_name</span><span class="delimiter">'</span></span> <span class="attribute-name">viewName</span>=<span class="string"><span class="delimiter">'</span><span class="content">lastNameField</span><span class="delimiter">'</span></span><span class="inline-delimiter">}}</span></span>
    <span class="tag">&lt;/div&gt;</span>
    <span class="tag">&lt;div&gt;</span>
      <span class="tag">&lt;label</span> <span class="inline"><span class="inline-delimiter">{{</span><span class="attribute-name">bindAttr</span> <span class="attribute-name">for</span>=<span class="string"><span class="delimiter">'</span><span class="content">quoteField.elementId</span><span class="delimiter">'</span></span><span class="inline-delimiter">}}</span></span><span class="tag">&gt;</span>Quote<span class="tag">&lt;/label&gt;</span>
      <span class="inline"><span class="inline-delimiter">{{</span><span class="attribute-name">view</span> <span class="attribute-name">Ember.TextArea</span> <span class="attribute-name">valueBinding</span>=<span class="string"><span class="delimiter">'</span><span class="content">quote</span><span class="delimiter">'</span></span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">'</span><span class="content">quote</span><span class="delimiter">'</span></span> <span class="attribute-name">viewName</span>=<span class="string"><span class="delimiter">'</span><span class="content">quoteField</span><span class="delimiter">'</span></span><span class="inline-delimiter">}}</span></span>
    <span class="tag">&lt;/div&gt;</span>
    <span class="tag">&lt;a</span> <span class="attribute-name">href</span>=<span class="string"><span class="delimiter">'</span><span class="content">#</span><span class="delimiter">'</span></span> <span class="inline"><span class="inline-delimiter">{{</span><span class="attribute-name">action</span> <span class="attribute-name">save</span><span class="inline-delimiter">}}</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">'</span><span class="content">btn btn-success</span><span class="delimiter">'</span></span><span class="tag">&gt;</span><span class="inline"><span class="inline-delimiter">{{</span><span class="attribute-name">buttonTitle</span><span class="inline-delimiter">}}</span></span><span class="tag">&lt;/a&gt;</span>
  <span class="tag">&lt;/fieldset&gt;</span>
<span class="tag">&lt;/form&gt;</span>
<span class="tag">&lt;div</span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">'</span><span class="content">page-header</span><span class="delimiter">'</span></span><span class="tag">&gt;</span><span class="tag">&lt;/div&gt;</span>

<span class="tag">&lt;a</span> <span class="attribute-name">href</span>=<span class="string"><span class="delimiter">'</span><span class="content">#</span><span class="delimiter">'</span></span> <span class="inline"><span class="inline-delimiter">{{</span><span class="attribute-name">action</span> <span class="attribute-name">cancel</span> <span class="attribute-name">target</span>=<span class="string"><span class="delimiter">'</span><span class="content">controller</span><span class="delimiter">'</span></span><span class="inline-delimiter">}}</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">'</span><span class="content">btn btn-inverse</span><span class="delimiter">'</span></span><span class="tag">&gt;</span>Cancel<span class="tag">&lt;/a&gt;</span>
</pre></td>
</tr></table>
</div></div>
<p>And in both the <code>new</code> and <code>edit</code> template remove the markup and replace with</p>
<div class="highlight handlebars "><div class="ribbon"></div><div class="scroller"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
</pre></td>
  <td class="code"><pre><span class="inline"><span class="inline-delimiter">{{</span> <span class="attribute-name">template</span> <span class="error">'</span><span class="attribute-name">users</span><span class="error">/</span><span class="attribute-name">form</span><span class="error">'</span> <span class="inline-delimiter">}}</span></span>
</pre></td>
</tr></table>
</div></div>
<p>Now we need to edit the two controllers. In <code>App.UsersNewController</code> add to the two attributes:</p>
<div class="highlight coffeescript "><div class="ribbon"></div><div class="scroller"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
2
</pre></td>
  <td class="code"><pre>headerTitle: 'Create'
buttonTitle: 'Create'
</pre></td>
</tr></table>
</div></div>
<p>And likewise in <code>App.UsersEditController</code>:</p>
<div class="highlight coffeescript "><div class="ribbon"></div><div class="scroller"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
2
</pre></td>
  <td class="code"><pre>headerTitle: 'Edit'
buttonTitle: 'Update'
</pre></td>
</tr></table>
</div></div>
<p>Last part for this section is to add the <code>update</code> action to <code>app/controllers/users_controller.rb</code>:</p>
<div class="highlight ruby "><div class="ribbon"></div><div class="scroller"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
2
3
4
5
6
7
8
</pre></td>
  <td class="code"><pre><span class="keyword">def</span> <span class="function">update</span>
  user = <span class="constant">User</span>.find(params[<span class="symbol">:id</span>])
  <span class="keyword">if</span> user.update_attributes(params[<span class="symbol">:user</span>])
    render <span class="key">json</span>: user
  <span class="keyword">else</span>
    render <span class="key">json</span>: user, <span class="key">status</span>: <span class="integer">422</span>
  <span class="keyword">end</span>
<span class="keyword">end</span>
</pre></td>
</tr></table>
</div></div>
<p>Now go through and everything should work! This allows us to treat the templates similar to a partial in Rails.</p>

<p>Finally we&#39;re going to add the ability to delete records. Because this is an action we are going to limit to the <code>edit</code> page we will put the link below the <code>render</code> call</p>
<div class="highlight handlebars "><div class="ribbon"></div><div class="scroller"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
</pre></td>
  <td class="code"><pre><span class="tag">&lt;a</span> <span class="attribute-name">href</span>=<span class="string"><span class="delimiter">'</span><span class="content">#</span><span class="delimiter">'</span></span> <span class="inline"><span class="inline-delimiter">{{</span><span class="attribute-name">action</span> <span class="error">'</span><span class="attribute-name">destroy</span><span class="error">'</span><span class="inline-delimiter">}}</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">'</span><span class="content">btn btn-danger</span><span class="delimiter">'</span></span><span class="tag">&gt;</span>Destroy<span class="tag">&lt;/a&gt;</span>
</pre></td>
</tr></table>
</div></div>
<p>Now we add the action to the <code>App.UsersEditController</code></p>
<div class="highlight coffeescript "><div class="ribbon"></div><div class="scroller"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
2
3
4
</pre></td>
  <td class="code"><pre>destroy: -&gt;
  @content.deleteRecord()
  @store.commit()
  @transitionToRoute 'users.index'
</pre></td>
</tr></table>
</div></div>
<p>And we add the <code>destroy</code> action to the backend</p>
<div class="highlight ruby "><div class="ribbon"></div><div class="scroller"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
2
3
4
5
6
7
8
</pre></td>
  <td class="code"><pre><span class="keyword">def</span> <span class="function">destroy</span>
  user = <span class="constant">User</span>.find(params[<span class="symbol">:id</span>])
  <span class="keyword">if</span> user.destroy
    render <span class="key">json</span>: user, <span class="key">status</span>: <span class="integer">204</span>
  <span class="keyword">else</span>
    render <span class="key">json</span>: user
  <span class="keyword">end</span>
<span class="keyword">end</span>
</pre></td>
</tr></table>
</div></div>
<p>The <code>204</code> status here is refers to <code>No Content</code>. Ember-data expects this to ensure the destroy action is a success.</p>

<p>That&#39;s it! You&#39;ve just created your very first Ember app with all of the CRUD actions. Congratulations!</p>
<div class='post__share'><div class='post__share__links'><a class='twitter-share-button' data-url='http://reefpoints.dockyard.com/ember/2013/01/10/building-an-ember-app-with-rails-api-part-3.html' data-via='DockYard' href='https://twitter.com/share'>Tweet</a><script>
  !function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0];if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src='//platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document,'script','twitter-wjs');
</script><div class='g-plusone' data-href='#' data-size='medium' data-width='100'></div><script>
  (function() {var po = document.createElement('script'); po.type = 'text/javascript'; po.async = true;po.src = 'https://apis.google.com/js/plusone.js';var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(po, s);})();
</script></div><p>This article is brought to you by <a class='text-link' href='http://dockyard.com/'>DockYard</a>. If you see an issue, please send a <a href='https://github.com/dockyard/reefpoints/blob/master/source/posts/', class='text-link post__issue', target: '_blank'>pull request</a> to contribute.</p><a class='button--post' href='http://dockyard.com/hire-us'>Hire Us</a></div></current_page></div></div><div class='post__comments'><div id='disqus_thread'></div><script>
  var disqus_shortname = 'reefpoints';
  (function() {
    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
    dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
</script><noscript>Please enable JavaScript to view the <a href='http://disqus.com/?ref_noscript'>comments powered by Disqus</a>.</noscript></noscript></div><script>
  var path = window.location.pathname.split('/').reverse();
  var postname = path[0].split('.');
  var change = postname[0] + '.md';
  var newpath = 'https://github.com/dockyard/reefpoints/blob/master/source/posts/' + path[3] + '-' + path[2] + '-' + path[1] + '-' + change
  $('.post__issue').attr('href', newpath);
  
  $('.search').submit(function(event) {
    event.preventDefault();
    window.location = $(this).data('url') + '#q=' + $('.search__input').val();
  });
</script>
<h2 class='nothin'>Your search returned no results. Perhaps you should try again.</h2></div><div class='push--big'></div><footer><div class='l-wrap'><div class='footer-group'><h3 class='footer-group__title'>EVENTS</h3><nav><a class='footer__event' href='http://wickedgoodruby.com/' target='_blank'><div class='footer__event--wgr'></div><h4 class='footer-title'>Wicked Good Ruby Conf</h4></a><a class='footer__event' href='http://www.meetup.com/Boston-Ember-js/' target='_blank'><div class='footer__event--ember'></div><h4 class='footer-title'>Boston Ember.js Meetup</h4></a><a class='footer__event' href='http://www.meetup.com/uxboston/' target='_blank'><div class='footer__event--ux'></div><h4 class='footer-title'>UX Boston Meetup</h4></a><a class='footer__event' href='http://openhack.github.io/boston/' target='_blank'><div class='footer__event--openhack'></div><h4 class='footer-title'>OpenHack Boston</h4></a></nav></div><div class='footer-group'><a href='/'><h3 class='footer-group__title'>BLOG</h3></a><nav class='blog-nav--footer'><a class='blog-nav-item--footer' href='/2013/12/19/ember-enum-property-cycler.html'><h4 class='footer-title'>Simple Property Enum Cycling in Ember</h4><p class='footer-desc'>A quick demo of cycling between a set of values</p></a><a class='blog-nav-item--footer' href='/2013/12/18/be-a-blunt-axe.html'><h4 class='footer-title'>Be A Blunt Axe</h4><p class='footer-desc'>Giving good feedback without being too aggressive.</p></a><a class='blog-nav-item--footer' href='/2013/12/08/introducing-easydir-vim.html'><h4 class='footer-title'>Introducing easydir.vim</h4><p class='footer-desc'>A Vim plugin that allows you create directories and files at the same time!</p></a></nav></div><div class='footer-group'><a href='/hire-us'><h3 class='footer-group__title'>CONTACT</h3></a><p class='footer-desc'>DockYard HQ is located in Boston. Stop in sometime and meet our team!</p><a class='footer-address has-border--top' href='https://www.google.com/maps/preview#!q=DockYard%2C+Tremont+Street+%23200%2C+Boston%2C+MA&amp;data=!4m15!2m14!1m13!1s0x89e37083512ceab3%3A0x1e657c639844318d!3m8!1m3!1d197180!2d-70.970284!3d42.31435!3m2!1i400!2i802!4f13.1!4m2!3d42.357236!4d-71.061077' target='_blank'><p class='footer-desc'>DockYard Inc.</p><p class='footer-desc'>101 Tremont Street</p><p class='footer-desc'>Suite 200</p><p class='footer-desc'>Boston, MA 02108</p></a><a class="text-link" href="http://dockyard.com/hire-us">Get in touch.</a><div class='footer-social has-border--top'><a class='social-nav-item' data-icon='#' href='https://twitter.com/dockyard' target='_blank'><span class='is-hidden'>Twitter</span></a><a class='social-nav-item' data-icon='★' href='https://github.com/dockyard' target='_blank'><span class='is-hidden'>GitHub</span></a><a class='social-nav-item' data-icon='✒' href='http://reefpoints.dockyard.com/atom.xml' target='_blank'><span class='is-hidden'>RSS</span></a></div></div></div></footer><audio class='foghorn' preload='auto' src='/sound/foghorn.mp3'></audio><script>
  /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
  var disqus_shortname = 'reefpoints'; // required: replace example with your forum shortname
  
  /* * * DON'T EDIT BELOW THIS LINE * * */
  (function () {
      var s = document.createElement('script'); s.async = true;
      s.type = 'text/javascript';
      s.src = 'http://' + disqus_shortname + '.disqus.com/count.js';
      (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
  }());
</script></body></html>
